# =================================================================
# GoCardless Server Deployment - Manuelle Befehle
# =================================================================
# 
# Kopiere diese Befehle einzeln in dein PowerShell-Terminal
# (außerhalb von VS Code oder im VS Code integrierten Terminal)
#
# Deine SSH-Keys sollten dort ohne Passwort funktionieren!
# =================================================================

# Schritt 1: .env aktualisieren
ssh root@167.235.24.110 "cd '/var/www/bereifung24' && cat >> .env << 'EOFMARKER'

# GoCardless (SEPA Direct Debit) - LIVE MODE
GOCARDLESS_ACCESS_TOKEN=\"live_WmP-dhJqZY7Amzn-J6TqYivdjL2OHefpmc0fYWrj\"
GOCARDLESS_ENVIRONMENT=\"live\"
GOCARDLESS_WEBHOOK_SECRET=\"\"
EOFMARKER
"

# Schritt 2: GoCardless Package installieren
ssh root@167.235.24.110 "cd '/var/www/bereifung24' && npm install gocardless-nodejs"

# Schritt 3: Database Migration
ssh root@167.235.24.110 "cd '/var/www/bereifung24' && npx prisma migrate deploy"

# KRITISCH: Schritt 4: Prisma Client regenerieren (nach Schema-Änderungen)
# ⚠️ NIEMALS VERGESSEN! Ohne diesen Schritt kennt Prisma neue Felder nicht!
ssh root@167.235.24.110 "source ~/.nvm/nvm.sh && cd '/var/www/bereifung24' && npx prisma generate"

# Schritt 5: App neu bauen
ssh root@167.235.24.110 "cd '/var/www/bereifung24' && npm run build"

# Schritt 6: PM2 neu starten (mit source für nvm)
ssh root@167.235.24.110 "source ~/.nvm/nvm.sh && cd '/var/www/bereifung24' && pm2 restart bereifung24"

# =================================================================
# Fertig! Wenn alles funktioniert hat, sage mir Bescheid!
# =================================================================
